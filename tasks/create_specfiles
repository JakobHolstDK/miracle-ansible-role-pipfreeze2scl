- name: 
  find:
    paths: /root/rpmbuild/SOURCES
    recurse: yes
    depth: 1
    file_type: directory
  register: sources

- name: create_specfiles
  ansible.builtin.shell: python3 setup.py bdist_rpm --spec-only
  args:
    chdir: "{{ mydir.path }}"
  stat: path={{ mydir.path }}/setup.py 
  register: p
  when: p.stat.isfile is defined
  become: True
  loop: "{{ sources.files }}" 
  loop_control:
    loop_var: mydir